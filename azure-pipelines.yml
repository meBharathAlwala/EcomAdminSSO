trigger:
  - main   # Change this to your GitHub branch name

variables:
  buildConfiguration: 'production'
  angularProjectName: 'EcomAdmin'

stages:
# -------- BUILD STAGE --------
-- stage: Build
  displayName: "Build Angular Application"
  jobs:
    - job: BuildAngular
      pool:
        name: 'Default'
      steps:
        - task: NodeTool@0
          inputs:
            versionSpec: '18.x'
          displayName: "Install Node.js"

        - script: |
            cd EcomAdminSSO
            npm install -g @angular/cli
            npm install
            ng build --configuration $(buildConfiguration)

            echo "=== Dist folder structure ==="
            dir dist /s /b > distPaths.txt
            type distPaths.txt
          displayName: "Build Angular Project & Show Output"

        - powershell: |
            $distFolder = Get-ChildItem "$(System.DefaultWorkingDirectory)\EcomAdminSSO\dist" -Directory | Select-Object -First 1
            if (-not $distFolder) { throw "No dist folder found after build!" }
            Write-Host "##vso[task.setvariable variable=distPath]$($distFolder.FullName)"
          displayName: "Detect Build Output Folder"

        - task: PublishBuildArtifacts@1
          inputs:
            PathtoPublish: '$(distPath)'
            ArtifactName: 'artifactname'
            publishLocation: 'Container'
          displayName: "Publish Compiled Angular App"

