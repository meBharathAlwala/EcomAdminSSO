trigger:
- main   # Change to your branch

variables:
  buildConfiguration: 'production'
  angularProjectName: 'EcomAdmin'

stages:
- stage: Build
  displayName: "Build Angular Application"
  jobs:
  - job: BuildAngular
    pool:
      name: 'Default'   # Self-hosted agent pool
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '18.x'
      displayName: "Install Node.js"

    - script: |
        cd "$(Build.SourcesDirectory)"
        echo Installing Angular CLI globally...
        npm install -g @angular/cli

        echo Installing dependencies...
        npm ci

        echo Building Angular project...
        npx ng build --configuration $(buildConfiguration)

        echo Verifying build output...
        if exist "dist\$(angularProjectName)\browser" (
            echo ✅ Build output found:
            dir dist\$(angularProjectName)\browser
        ) else (
            echo ❌ Build failed: dist\$(angularProjectName)\browser not found.
            dir dist
            exit /b 1
        )
      displayName: "Install Dependencies, Build & Verify Angular Project"
      workingDirectory: "$(Build.SourcesDirectory)"
